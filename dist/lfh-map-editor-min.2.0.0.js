var L=L||require("leaflet"),_MAX_POINT_INTERVAL_MS=15e3,_SECOND_IN_MILLIS=1e3,_MINUTE_IN_MILLIS=60*_SECOND_IN_MILLIS,_HOUR_IN_MILLIS=60*_MINUTE_IN_MILLIS,_DAY_IN_MILLIS=24*_HOUR_IN_MILLIS,_DEFAULT_MARKER_OPTS={startIconUrl:"pin-icon-start.png",endIconUrl:"pin-icon-end.png",shadowUrl:"pin-shadow.png",wptIconUrls:{"":"pin-icon-wpt.png"},iconSize:[33,50],shadowSize:[50,50],iconAnchor:[16,45],shadowAnchor:[16,47],clickable:!1},_DEFAULT_POLYLINE_OPTS={color:"blue"},_DEFAULT_GPX_OPTS={parseElements:["track","route","waypoint"]};L.GPX=L.FeatureGroup.extend({initialize:function(e,t){t.max_point_interval=t.max_point_interval||_MAX_POINT_INTERVAL_MS,t.marker_options=this._merge_objs(_DEFAULT_MARKER_OPTS,t.marker_options||{}),t.polyline_options=this._merge_objs(_DEFAULT_POLYLINE_OPTS,t.polyline_options||{}),t.gpx_options=this._merge_objs(_DEFAULT_GPX_OPTS,t.gpx_options||{}),L.Util.setOptions(this,t),L.GPXTrackIcon=L.Icon.extend({options:t.marker_options}),this._gpx=e,this._layers={},this._info={name:null,length:0,elevation:{gain:0,loss:0,max:0,min:1/0,_points:[]},hr:{avg:0,_total:0,_points:[]},duration:{start:null,end:null,moving:0,total:0}},e&&this._parse(e,t,this.options.async)},get_duration_string:function(e,t){var n="";e>=_DAY_IN_MILLIS&&(n+=Math.floor(e/_DAY_IN_MILLIS)+"d ",e%=_DAY_IN_MILLIS),e>=_HOUR_IN_MILLIS&&(n+=Math.floor(e/_HOUR_IN_MILLIS)+":",e%=_HOUR_IN_MILLIS);var o=Math.floor(e/_MINUTE_IN_MILLIS);e%=_MINUTE_IN_MILLIS,o<10&&(n+="0"),n+=o+"'";var r=Math.floor(e/_SECOND_IN_MILLIS);return e%=_SECOND_IN_MILLIS,r<10&&(n+="0"),n+=r,n+=!t&&e>0?"."+Math.round(1e3*Math.floor(e))/1e3:'"'},to_miles:function(e){return e/1.60934},to_ft:function(e){return 3.28084*e},m_to_km:function(e){return e/1e3},m_to_mi:function(e){return e/1609.34},get_name:function(){return this._info.name},get_desc:function(){return this._info.desc},get_author:function(){return this._info.author},get_copyright:function(){return this._info.copyright},get_distance:function(){return this._info.length},get_distance_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))},get_start_time:function(){return this._info.duration.start},get_end_time:function(){return this._info.duration.end},get_moving_time:function(){return this._info.duration.moving},get_total_time:function(){return this._info.duration.total},get_moving_pace:function(){return this.get_moving_time()/this.m_to_km(this.get_distance())},get_moving_pace_imp:function(){return this.get_moving_time()/this.get_distance_imp()},get_moving_speed:function(){return this.m_to_km(this.get_distance())/(this.get_moving_time()/36e5)},get_moving_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_moving_time()/36e5)},get_total_speed:function(){return this.m_to_km(this.get_distance())/(this.get_total_time()/36e5)},get_total_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_total_time()/36e5)},get_elevation_gain:function(){return this._info.elevation.gain},get_elevation_loss:function(){return this._info.elevation.loss},get_elevation_gain_imp:function(){return this.to_ft(this.get_elevation_gain())},get_elevation_loss_imp:function(){return this.to_ft(this.get_elevation_loss())},get_elevation_data:function(){var e=this;return this._info.elevation._points.map(function(t){return e._prepare_data_point(t,e.m_to_km,null,function(e,t){return null==e||null==t?null:e.toFixed(2)+" km, "+t.toFixed(0)+" m"})})},get_elevation_data_imp:function(){var e=this;return this._info.elevation._points.map(function(t){return e._prepare_data_point(t,e.m_to_mi,e.to_ft,function(e,t){return e.toFixed(2)+" mi, "+t.toFixed(0)+" ft"})})},get_elevation_max:function(){return this._info.elevation.max},get_elevation_min:function(){return this._info.elevation.min},get_elevation_max_imp:function(){return this.to_ft(this.get_elevation_max())},get_elevation_min_imp:function(){return this.to_ft(this.get_elevation_min())},get_average_hr:function(){return this._info.hr.avg},get_heartrate_data:function(){var e=this;return this._info.hr._points.map(function(t){return e._prepare_data_point(t,e.m_to_km,null,function(e,t){return e.toFixed(2)+" km, "+t.toFixed(0)+" bpm"})})},get_heartrate_data_imp:function(){var e=this;return this._info.hr._points.map(function(t){return e._prepare_data_point(t,e.m_to_mi,null,function(e,t){return e.toFixed(2)+" mi, "+t.toFixed(0)+" bpm"})})},get_options:function(){return this.getLayers()[0].getLayers()[0].options},reload:function(){this.clearLayers(),this._parse(this._gpx,this.options,this.options.async)},get_markers:function(){return this._markers},_merge_objs:function(e,t){var n={};for(var o in e)n[o]=e[o];for(var o in t)n[o]=t[o];return n},_prepare_data_point:function(e,t,n,o){var r=[t&&t(e[0])||e[0],n&&n(e[1])||e[1]];return r.push(o&&o(r[0],r[1])||r[0]+": "+r[1]),r},_load_xml:function(e,t,n,o){void 0==o&&(o=this.options.async),void 0==n&&(n=this.options);var r=new window.XMLHttpRequest;r.open("GET",e,o);try{r.overrideMimeType("text/xml")}catch(e){}var i=this;r.onreadystatechange=function(){4==r.readyState&&(200==r.status?t(r.responseXML,n):i.options.isLoaded=!0)},r.send(null)},_parse:function(e,t,n){var o=this,r=function(e,t){var n=o._parse_gpx_data(e,t);if(!n)return void(o.options.isLoaded=!0);o.addLayer(n),o.fire("loaded")};if("<"===e.substr(0,1)){var i=new DOMParser;n?setTimeout(function(){r(i.parseFromString(e,"text/xml"),t)}):r(i.parseFromString(e,"text/xml"),t)}else this._load_xml(e,r,t,n)},_markers:[],_parse_gpx_data:function(e,t){var n,o,r,i=[],a=[],l=t.gpx_options.parseElements;l.indexOf("route")>-1&&a.push(["rte","rtept"]),l.indexOf("track")>-1&&a.push(["trkseg","trkpt"]);var c=e.getElementsByTagName("name");c.length>0&&(this._info.name=c[0].textContent);var s=e.getElementsByTagName("desc");s.length>0&&(this._info.desc=s[0].textContent);var m=e.getElementsByTagName("author");m.length>0&&(this._info.author=m[0].textContent);var u=e.getElementsByTagName("copyright");for(u.length>0&&(this._info.copyright=u[0].textContent),n=0;n<a.length;n++)for(r=e.getElementsByTagName(a[n][0]),o=0;o<r.length;o++){var d=this._parse_trkseg(r[o],e,t,a[n][1]);if(0!==d.length){var _=new L.Polyline(d,t.polyline_options);if(this.fire("addline",{line:_}),i.push(_),t.marker_options.startIcon||t.marker_options.startIconUrl){var p=new L.Marker(d[0],{clickable:t.marker_options.clickable,icon:t.marker_options.startIcon||new L.GPXTrackIcon({iconUrl:t.marker_options.startIconUrl})});this._markers.push(p),this.fire("addpoint",{point:p,point_type:"start"}),i.push(p)}(t.marker_options.endIcon||t.marker_options.endIconUrl)&&(p=new L.Marker(d[d.length-1],{clickable:t.marker_options.clickable,icon:t.marker_options.endIcon||new L.GPXTrackIcon({iconUrl:t.marker_options.endIconUrl})}),this._markers.push(p),this.fire("addpoint",{point:p,point_type:"end"}),i.push(p))}}if(this._info.hr.avg=Math.round(this._info.hr._total/this._info.hr._points.length),l.indexOf("waypoint")>-1)for(r=e.getElementsByTagName("wpt"),o=0;o<r.length;o++){var h=new L.LatLng(r[o].getAttribute("lat"),r[o].getAttribute("lon")),f=r[o].getElementsByTagName("name"),c="";f.length>0&&(c=f[0].textContent);var g=r[o].getElementsByTagName("desc"),s="";g.length>0&&(s=g[0].textContent);var v=r[o].getElementsByTagName("sym"),k="";v.length>0&&(k=v[0].textContent);var y;if(t.marker_options.wptIcons&&t.marker_options.wptIcons[k])y=t.marker_options.wptIcons[k];else{if(!t.marker_options.wptIconUrls||!t.marker_options.wptIconUrls[k]){console.log('No icon or icon URL configured for symbol type "'+k+'"; ignoring waypoint.');continue}y=new L.GPXTrackIcon({iconUrl:t.marker_options.wptIconUrls[k]})}var w=new L.Marker(h,{clickable:!0,title:c,icon:y});w.bindPopup("<b>"+c+"</b>"+(s.length>0?"<br>"+s:"")).openPopup(),this.fire("addpoint",{point:w,point_type:"waypoint"}),i.push(w)}return i.length>1?new L.FeatureGroup(i):1==i.length?i[0]:void 0},_parse_trkseg:function(e,t,n,o){var r=e.getElementsByTagName(o);if(!r.length)return[];for(var i=[],a=null,l=0;l<r.length;l++){var c,s=new L.LatLng(r[l].getAttribute("lat"),r[l].getAttribute("lon"));if(s.meta={time:null,ele:null,hr:null},c=r[l].getElementsByTagName("time"),c.length>0&&(s.meta.time=new Date(Date.parse(c[0].textContent))),c=r[l].getElementsByTagName("ele"),c.length>0&&(s.meta.ele=parseFloat(c[0].textContent)),c=r[l].getElementsByTagNameNS("*","hr"),c.length>0&&(s.meta.hr=parseInt(c[0].textContent),this._info.hr._points.push([this._info.length,s.meta.hr]),this._info.hr._total+=s.meta.hr),s.meta.ele>this._info.elevation.max&&(this._info.elevation.max=s.meta.ele),s.meta.ele<this._info.elevation.min&&(this._info.elevation.min=s.meta.ele),this._info.elevation._points.push([this._info.length,s.meta.ele]),this._info.duration.end=s.meta.time,null!=a){this._dist3d(a,s);this._info.length+=this._dist3d(a,s);var m=s.meta.ele-a.meta.ele;m>0?this._info.elevation.gain+=m:this._info.elevation.loss+=Math.abs(m),m=Math.abs(s.meta.time-a.meta.time),this._info.duration.total+=m,m<n.max_point_interval&&(this._info.duration.moving+=m)}else this._info.duration.start=s.meta.time;a=s,i.push(s)}return i},_dist2d:function(e,t){var n=this._deg2rad(t.lat-e.lat),o=this._deg2rad(t.lng-e.lng),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this._deg2rad(e.lat))*Math.cos(this._deg2rad(t.lat))*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371e3},_dist3d:function(e,t){var n=this._dist2d(e,t),o=Math.abs(t.meta.ele-e.meta.ele);return Math.sqrt(Math.pow(n,2)+Math.pow(o,2))},_deg2rad:function(e){return e*Math.PI/180}}),"object"==typeof module&&"object"==typeof module.exports?module.exports=L:"function"==typeof define&&define.amd&&define(L),String.prototype.stripslashes=function(){return this.replace(/\\(.?)/g,function(e,t){switch(t){case"\\":return"\\";case"0":return"\0";case"":return"";default:return t}})},function(e,t){function n(e){return"false"!==e&&Boolean(e)}var o=L.Control.extend({options:{position:"topleft"},onAdd:function(e){return document.querySelector("#lfh-control")}});console.log(t.data);var r={mode:"lfh-view",tiles:t.tiles,map:null,center:[48.67777858405578,2.166026472914382],zoom:2,latlngbounds:[],current_marker:null,default_icon:null,move_marker:null,markers:new Array,gpx:new Array,tile:null,record:null,shortcode:{map:"[lfh-map]",gpx:"",markers:""},map_options:{},controlLayer:null,POINT_ICON:L.icon({iconUrl:t.ICON_URL+"markers/pointS000063.png",iconSize:[10,10],shadowSize:[0,0],iconAnchor:[5,5],shadowAnchor:[5,5],popupAnchor:[5,5]}),init_map:function(){var e=function(e){return!!e},n=t.data.find(e).map;r.init_map_options(n),r.map=L.map("map").setView(r.center,r.zoom),r.set_tile(),r.map.addControl(new o);var i=document.querySelectorAll(".marker-control");[].forEach.call(i,function(e){L.DomEvent.addListener(e,"click",function(t){r.set_mode(e),t.stopPropagation()})}),r.controlLayer=L.control.layers(),r.default_icon=L.AwesomeMarkers.icon({icon:"circle",prefix:"lfhicon",markerColor:"red"}),r.move_marker=L.marker(r.center).addTo(r.map),r.move_marker.setOpacity(0),r.map.on("mousemove",function(e){switch(r.mode){case"lfh-add-marker":r.move_marker.setLatLng(e.latlng)}}),r.map.on("click",function(e){"lfh-add-marker"==r.mode&&r.add_marker(e)}),r.init_data()},init_map_options:function(e){r.init_listener_map_editor();for(var t in e){var o=document.querySelector('[name="lfh-form-map-'+t+'"]');"checkbox"===o.type?o.checked=n(e[t]):o.value=e[t],["fullscreen","tile","open"].indexOf(t)>=0&&(document.querySelector('input[name="lfh-form-global-'+t+'"]').checked=!1,o.disabled=!1)}},init_listener_map_editor:function(){var e=document.querySelectorAll('#window-edit-map [name^="fh-form-map"]');[].forEach.call(e,function(e){L.DomEvent.addListener(e,"change",function(t){switch(e.name.replace("lfh-form-map-","")){case"autocenter":document.querySelector("#center-map").style.visibility=t.target.checked?"collapse":"visible",r.get_position_info();break;case"tile":r.set_tile()}})});var o=document.querySelector('input[name="save-center"]');L.DomEvent.addListener(o,"click",function(e){r.get_position_info()});var e=document.querySelectorAll('#window-edit-map input[name^="lfh-form-global-"]');[].forEach.call(e,function(e){L.DomEvent.addListener(e,"click",function(e){console.log(this.checked);var o=this.parentNode.parentNode.querySelector('[name^="lfh-form-map"]');if(o.disabled=this.checked,this.checked){var i=o.name.replace("lfh-form-map-","");"checkbox"===o.type?o.checked=n(t.default.map[i]):(o.value=t.default.map[i],r.set_tile())}})});var i=document.createEvent("MouseEvents");i.initEvent("click",!0,!0),document.querySelector('#window-edit-map input[type="reset"]').dispatchEvent(i),document.querySelector('#window-edit-map input[type="reset"]').onclick=function(){document.querySelector("#center-map").style.display="none",["fullscreen","tile","open"].forEach(function(e){document.querySelector('[name="lfh-form-map-'+e+'"]').disabled=!0}),setTimeout(function(){null!=r.tiles&&r.set_tile()},500)}},init_data:function(){t.data.forEach(function(e){e.markers&&e.markers.forEach(function(e){console.log("add marker"),e.latlng=L.latLng(e.lat,e.lng),e.iconAwesome=L.AwesomeMarkers.icon({icon:e.icon,prefix:"lfhicon",markerColor:e.color}),r.add_marker(e)}),e.gpx&&e.gpx.forEach(function(e){r.add_gpx(e)})})},set_tile:function(){var e=document.querySelector('select[name="lfh-form-map-tile"]').value,t=r.tiles[e];null!=r.tile&&r.map.removeLayer(r.tile),r.tile=L.tileLayer(t.url,{attribution:t.attribution}),r.tile.addTo(r.map)},add_marker:function(e){return r.current_marker=L.marker(e.latlng,{icon:e.iconAwesome?e.iconAwesome:r.default_icon,draggable:!0,index:r.markers.length,title:e.title?e.title:"",popup:e.popup?e.popup:"",description:!!e.description,content:e.description,visibility:e.visibility?e.visibility:"always"}).addTo(r.map),r.markers.push(r.current_marker),r.current_marker.on("click",function(e){switch(r.mode){case"lfh-edit-marker":r.current_marker=this,r.init_window();break;case"lfh-delete-marker":r.current_marker=null,r.delete_marker(this)}}),r.set_mode(document.querySelector("#lfh-edit-marker")),r.current_marker},add_marker_from_form:function(){var e=document.querySelector('#window-add-marker input[name="lfh-lat"]').value,t=document.querySelector('#window-add-marker input[name="lfh-lng"]').value,n={lat:e,lng:t};r.add_marker({latlng:n})},delete_marker:function(e){if(confirm(r.confirm)){for(var t=e.options.index,n=t;n<r.markers.length-1;n++)r.markers[n]=r.markers[n+1],r.markers[n].options.index=n;r.map.removeLayer(e),r.markers.pop()}},set_mode:function(t){"lfh-view"!==r.mode&&e(".marker-control.active").removeClass("active");var n=document.querySelectorAll(".lfh-form-edit");[].forEach.call(n,function(e){e.style.display="none"}),t.id===r.mode?r.mode="lfh-view":(r.mode=t.id,t.className=t.className+" active",r.init_window()),console.log(r.mode),r.mode.indexOf("lfh-add")>=0&&e("#lfh-add-element").addClass("active"),"lfh-add-marker"==r.mode?(r.move_marker.setOpacity(1),document.querySelector("#window-add-marker").style.display="block"):r.move_marker.setOpacity(0)},add_gpx:function(e){console.log(e);var n=e.src?e.src:e.url,o=e.color?e.color:t.default.gpx.color,i=e.width?e.width:t.default.gpx.width;if(r.gpx[n])return void r.gpx[n].el.setStyle({color:o,weight:i});var a=new L.GPX(n,{async:!0,isLoaded:!1,polyline_options:{color:o,weight:i}}).on("loaded",function(e){if(e.target.options.isLoaded=!0,_auto_center){var t=e.target.getBounds();r.latlngbounds.push([t.getNorth(),t.getEast()]),r.latlngbounds.push([t.getSouth(),t.getWest()])}}).addTo(r.map);r.gpx[n]={el:a,description:e.description,content:e.content,title:e.title}},get_position_info:function(){r.record={center:r.map.getCenter(),zoom:r.map.getZoom()},r.write_position()},write_position:function(){var e="<b> lat</b> = "+r.record.center.lat+"<br />";e+="<b> lng</b> = "+r.record.center.lng+"<br />",e+="<b> zoom</b> = "+r.record.zoom,document.querySelector("#map-position").innerHTML=e},init_window:function(){switch(r.mode){case"lfh-edit-map":document.querySelector("#window-edit-map").style.display="block";break;case"lfh-edit-marker":if(null==r.current_marker)return;var e=r.current_marker.options,t=e.icon.options.markerColor,n=e.icon.options.icon;document.querySelector('#window-edit-marker input[name="title"]').value=e.title.stripslashes(),document.querySelector('#window-edit-marker textarea[name="popup"]').value=e.popup.stripslashes(),document.querySelector('#window-edit-marker input[name="description"]').checked=e.description,console.log(e.content),document.querySelector("#marker-description").value=e.content,document.querySelector('#window-edit-marker select[name="visibility"]').selectedIndex="always"==e.visibility?0:1;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!0),document.querySelector("#color-marker div.awesome-marker-icon-"+t).dispatchEvent(o),document.querySelector("#icon-marker div.lfhicon-"+n).dispatchEvent(o),document.querySelector("#window-edit-marker").style.display="block"}},close_window:function(e){switch(e){case"window-edit-marker":r.close_color(),r.close_icon(),document.querySelector("#"+e).style.display="none";break;case"window-edit-map":var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),document.querySelector("#lfh-edit-map").dispatchEvent(t);break;case"window-add-marker":document.querySelector("#"+e).style.display="none"}},close_color:function(){var e=document.querySelector("#window-edit-marker .to-extend label "),t=e.parentNode.querySelector("div");"-"==e.textContent&&(e.textContent="+",t.style.display="none")},close_icon:function(){var t=e("#window-edit-marker .to-extend label").eq(1),n=t.parent().find("> div");"-"==t.textContent&&(t.textContent="+",n.style.display="none")},write_checked:function(e){document.querySelector('input[name="'+r.map_var[e]+'"]').checked},shortcode_map:function(){var e="";return e+="[lfh-map ",document.querySelector('input[name="lfh-form-map-autocenter"]').checked||(e+=" lat="+r.record.center.lat,e+=" lng="+r.record.center.lng,e+=" zoom="+r.record.zoom),""!=document.querySelector('input[name="lfh-form-map-class"]').value&&(e+=' class="'+document.querySelector('input[name="lfh-form-map-class"]').value.replaceAll("-","\\-")+'"'),["autocenter","fullscreen","reset","list","mousewheel","open","undermap"].forEach(function(t){e+=" "+t+"="+document.querySelector('input[name="lfh-form-map-'+t+'"]').checked}),["width","height"].forEach(function(t){e+=" "+t+"="+document.querySelector('input[name="lfh-form-map-'+t+'"]').value}),e+=" tile="+document.querySelector('select[name="lfh-form-map-tile"]').value,e+=" ] <br /> "},shortcode:function(){var e="";e+=r.shortcode_map();for(var t=0;t<r.markers.length;t++){var n=r.markers[t].getLatLng(),o=r.markers[t].options,i=o.icon.options.markerColor,a=o.icon.options.icon;e+="[lfh-marker lat="+n.lat+" lng="+n.lng,e+=" color="+i+" icon="+a,e+=' title="'+o.title+'"',e+=' popup="'+o.popup+'"',e+=" visibility="+o.visibility,e+=" ]",o.description&&(e+=o.description),e+="[/lfh-marker]"}return r.gpx.forEach(function(t){shortocde+="[lfh-gpx src="+t.src,e+=" color="+t.color,e+=" width="+t.width,e+="][/lfh-gpx]"}),e}};L.DomEvent.addListener(document.querySelector("form"),"submit",function(e){e.preventDefault()});var i={selected:null,x_pos:0,y_pos:0,x_elem:0,y_elem:0,init:function(e){i.selected=e,i.x_elem=i.x_pos-i.selected.offsetLeft,i.y_elem=i.y_pos-i.selected.offsetTop},move:function(e){if(i.x_pos=document.all?window.event.clientX:e.pageX,i.y_pos=document.all?window.event.clientY:e.pageY,null!==i.selected){var t=Math.min(Math.max(-200,i.x_pos-i.x_elem),window.innerWidth-100);i.selected.style.left=t+"px";var n=Math.min(Math.max(0,i.y_pos-i.y_elem),window.innerHeight-40);i.selected.style.top=n+"px"}},destroy:function(){i.selected=null}};document.onmousemove=i.move,document.onmouseup=i.destroy;var a=document.querySelectorAll(".lfh-form-edit .header");[].forEach.call(a,function(e){L.DomEvent.addListener(e,"mousedown",function(t){i.init(e.parentNode)})});var l=document.querySelectorAll(".lfhicon-close");[].forEach.call(l,function(e){L.DomEvent.addListener(e,"click",function(t){var n=e.parentNode.parentNode.id;r.close_window(n)})});var l=document.querySelectorAll(".to-extend label");[].forEach.call(l,function(e){L.DomEvent.addListener(e,"click",function(e){var t=e.target,n=t.parentNode.querySelector("div");"+"==t.textContent?(t.textContent="-",n.style.display="inline-block"):(t.textContent="+",n.style.display="none")})});var c=document.querySelector('#window-add-marker input[name="placeMarker"]');L.DomEvent.addListener(c,"click",function(e){r.add_marker_from_form()});var c=document.querySelector('#window-edit-marker input[name="title"]');L.DomEvent.addListener(c,"change",function(e){r.current_marker.options.title=this.value.addslashes()});var c=document.querySelector('#window-edit-marker textarea[name="popup"]');L.DomEvent.addListener(c,"change",function(e){var t=this.value;r.current_marker.options.popup=this.value.addslashes(),r.current_marker.bindPopup(t).openPopup()});var c=document.querySelector("#window-edit-marker input[name='description']");L.DomEvent.addListener(c,"click",function(e){r.current_marker.options.description=this.checked});var c=document.querySelector("#window-edit-marker select");L.DomEvent.addListener(c,"change",function(e){r.current_marker.options.visibility=this.value});var l=document.querySelectorAll("#selected-icon , #selected-color");[].forEach.call(l,function(e){L.DomEvent.addListener(e,"focus",function(t){for(var n=e.parentNode.nextSibling;1!=n.nodeType;)n=n.nextSibling;n.querySelector("label").textContent="-",n.querySelector("div").style.display="inline-block","selected-icon"==e.id&&r.close_color()})});var l=document.querySelectorAll("#color-marker div.awesome-marker");[].forEach.call(l,function(e){L.DomEvent.addListener(e,"click",function(e){var t=this,n=document.querySelector("#color-marker div.selected"),o=n.className.replace(" selected","");n.className=o,o=t.className,t.className=o+" selected";var i=t.dataset.value,n=document.querySelector("#selected-color");n.className=o,n.dataset.value=i;var a=document.querySelector("#selected-icon").dataset.value;r.current_marker.setIcon(L.AwesomeMarkers.icon({icon:a,prefix:"lfhicon",markerColor:i}))})});var l=document.querySelectorAll("#icon-marker div.lfhicon");[].forEach.call(l,function(e){L.DomEvent.addListener(e,"click",function(e){var t=this,n=document.querySelector("#icon-marker div.selected"),o=n.className.replace(" selected","");n.className=o,o=t.className,t.className=o+" selected";var i=t.dataset.value,n=document.querySelector("#selected-icon");n.className=o,n.dataset.value=i;var a=document.querySelector("#selected-color").dataset.value;r.current_marker.setIcon(L.AwesomeMarkers.icon({icon:i,prefix:"lfhicon",markerColor:a}))})});var s=null,m=null,u=null;document.querySelector("#lfh-add-gpx").addEventListener("click",function(e){u=null,s||(s=wp.media({title:"Insert a gpx",library:{type:"application/gpx+xml"},multiple:!0,button:{text:"Insert"}}),s.on("select",function(){s.state().get("selection").forEach(function(e){r.add_gpx(e.toJSON())})})),s.open()}),document.querySelector("#insert-media-button").addEventListener("click",function(e){m||(m=wp.media({title:"Insert a media",library:{type:"image"},multiple:!0,button:{text:"Insert"}}),m.open())}),r.init_map()}(jQuery,lfh),String.prototype.addslashes=function(){return this.replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},String.prototype.stripslashes=function(){return this.replace(/\\(.?)/g,function(e,t){switch(t){case"\\":return"\\";case"0":return"\0";case"":return"";default:return t}})},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)};